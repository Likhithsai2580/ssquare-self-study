{% extends "base.html" %}

{% block content %}
    <h1 class="text-3xl font-bold mb-8">Login</h1>
    
    <!-- Existing login form -->
    <form method="POST" class="max-w-md mb-8">
        <!-- ... existing form fields ... -->
    </form>
    
    <h2 class="text-2xl font-bold mb-4">Or login with Firebase</h2>
    <button id="firebaseLogin" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Login with Google</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script>
        const firebaseConfig = {{ config.FIREBASE_CONFIG|tojson|safe }};
        firebase.initializeApp(firebaseConfig);

        document.getElementById('firebaseLogin').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then((result) => {
                    return result.user.getIdToken();
                })
                .then((idToken) => {
                    return fetch('/firebase_login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ idToken: idToken }),
                    });
                })
                .then((response) => response.json())
                .then((data) => {
                    if (data.error) {
                        console.error('Login error:', data.error);
                    } else {
                        window.location.href = '/dashboard';
                    }
                })
                .catch((error) => {
                    console.error('Firebase login error:', error);
                });
        });
    </script>
{% endblock %}